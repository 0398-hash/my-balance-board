<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Balance Board</title>
<style>
* { box-sizing: border-box; }
body { margin: 0; font-family: sans-serif; background: linear-gradient(135deg, #e0f2fe 0%, #f3e8ff 50%, #fce7f3 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 900px; margin: 0 auto; }
.header { text-align: center; margin-bottom: 40px; }
.header h1 { font-size: 36px; color: #374151; margin: 0; }
.header p { color: #6b7280; font-size: 14px; margin-top: 8px; }
.card { background: white; border-radius: 24px; padding: 40px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.card.editing { background: #fef3c7; border: 4px solid #fbbf24; }
.label { font-size: 18px; font-weight: bold; color: #374151; margin-bottom: 15px; display: block; }
input[type="date"], textarea { width: 100%; padding: 16px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 12px; }
textarea { resize: none; height: 120px; font-family: sans-serif; }
.slider-container { margin: 40px 0; padding: 10px 0; }
.slider { width: 100%; height: 14px; border-radius: 7px; outline: none; -webkit-appearance: none; background: #d1d5db; cursor: pointer; }
.slider.physical { background: linear-gradient(90deg, #86efac 0%, #d1d5db 0%); }
.slider.mental { background: linear-gradient(90deg, #fca5a5 0%, #d1d5db 0%); }
.slider::-webkit-slider-track { height: 14px; border-radius: 7px; }
.slider::-webkit-slider-thumb { -webkit-appearance: none; width: 48px; height: 48px; background: white; border: 5px solid #86efac; border-radius: 50%; cursor: grab; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: transform 0.15s ease; }
.slider::-webkit-slider-thumb:hover { transform: scale(1.1); }
.slider::-webkit-slider-thumb:active { cursor: grabbing; transform: scale(1.15); }
.slider::-moz-range-track { height: 14px; border-radius: 7px; background: #d1d5db; border: none; }
.slider::-moz-range-thumb { width: 48px; height: 48px; background: white; border: 5px solid #86efac; border-radius: 50%; cursor: grab; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: transform 0.15s ease; }
.slider::-moz-range-thumb:hover { transform: scale(1.1); }
.slider::-moz-range-thumb:active { cursor: grabbing; transform: scale(1.15); }
.slider.mental::-webkit-slider-thumb { border-color: #fca5a5; }
.slider.mental::-moz-range-thumb { border-color: #fca5a5; }
.btn { width: 100%; padding: 22px; font-size: 18px; font-weight: bold; color: white; border: none; border-radius: 12px; cursor: pointer; margin-top: 15px; }
.btn:hover { opacity: 0.9; transform: scale(1.02); transition: all 0.2s; }
.btn:active { transform: scale(0.98); }
.btn-primary { background: linear-gradient(135deg, #a78bfa 0%, #ec4899 100%); }
.btn-success { background: linear-gradient(135deg, #34d399 0%, #14b8a6 100%); }
.btn-info { background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); }
.btn-cancel { background: #6b7280; }
.btn-edit { background: #3b82f6; padding: 10px 18px; font-size: 14px; display: inline-block; width: auto; margin: 0 5px; border-radius: 8px; }
.record { background: #f9fafb; padding: 20px; margin: 15px 0; border-radius: 12px; border: 2px solid #e5e7eb; }
.record:hover { border-color: #a78bfa; }
.record-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
.badge { display: inline-block; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: bold; margin: 0 5px; }
.badge-green { background: #d1fae5; color: #065f46; }
.badge-red { background: #fee2e2; color: #991b1b; }
.notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #10b981; color: white; padding: 16px 32px; border-radius: 12px; font-weight: bold; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); max-width: 90%; text-align: center; }
.notification.error { background: #ef4444; }
.notification.info { background: #3b82f6; }
.hidden { display: none; }
#chartCanvas { width: 100%; height: 400px; background: white; border-radius: 12px; display: block; }
@media (max-width: 600px) {
  .card { padding: 25px; }
  .header h1 { font-size: 28px; }
  #chartCanvas { height: 350px; }
}
</style>
</head>
<body>

<div id="notification" class="notification hidden"></div>

<div class="container">
  <div class="header">
    <h1>My Balance Board</h1>
    <p>ã‚ãªãŸã®ãƒãƒ©ãƒ³ã‚¹ã‚’è¦‹ãˆã‚‹åŒ–</p>
  </div>

  <div id="inputCard" class="card">
    <label class="label" id="dateLabel">ğŸ“… è¨˜éŒ²ã™ã‚‹æ—¥ä»˜</label>
    <input type="date" id="dateInput">

    <div class="slider-container">
      <label class="label">ğŸ§ ä½“ã®èª¿å­ <span id="physicalValue">5</span>/10</label>
      <input type="range" min="1" max="10" value="5" class="slider physical" id="physicalSlider">
    </div>

    <div class="slider-container">
      <label class="label">ğŸ’— å¿ƒã®èª¿å­ <span id="mentalValue">5</span>/10</label>
      <input type="range" min="1" max="10" value="5" class="slider mental" id="mentalSlider">
    </div>

    <label class="label">ğŸ“ ä»Šæ—¥ã®ãƒ¡ãƒ¢</label>
    <textarea id="memoInput" placeholder="æ°—ã«ãªã£ãŸã“ã¨ã€æ„Ÿã˜ãŸã“ã¨..."></textarea>

    <button class="btn btn-primary" id="saveBtn" onclick="saveRecord()">âœ“ è¨˜éŒ²ã™ã‚‹</button>
    <button class="btn btn-cancel" id="cancelBtn" onclick="cancelEdit()" style="display:none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>

  <div id="chartCard" class="card hidden">
    <h2 style="margin-top:0; margin-bottom:10px; font-size:22px; color:#374151;">ğŸ“Š éå»7æ—¥é–“ã®æ¨ç§»</h2>
    <p style="color:#6b7280; font-size:14px; margin-bottom:20px;">ã‚°ãƒ©ãƒ•ã®æ£’ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ãƒ¡ãƒ¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
    <canvas id="chartCanvas"></canvas>
  </div>

  <div id="recordsCard" class="card hidden">
    <h2 style="margin-top:0; margin-bottom:20px; font-size:22px; color:#374151;">ğŸ“‹ è¨˜éŒ²ä¸€è¦§</h2>
    <div id="recordsList"></div>
  </div>

  <div id="exportCard" class="card hidden">
    <h2 style="margin-top:0; margin-bottom:20px; font-size:22px; color:#374151;">ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰</h2>
    <button class="btn btn-info" onclick="copyForAI()">ğŸ“‹ AIåˆ†æç”¨ã«ã‚³ãƒ”ãƒ¼</button>
    <button class="btn btn-success" onclick="generateEmail()">ğŸ“¨ ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’ä½œæˆ</button>
  </div>

  <div class="card" style="text-align:center; padding:20px; background:transparent; box-shadow:none;">
    <p style="color:#9ca3af; font-size:13px;">ğŸ”’ ãƒ‡ãƒ¼ã‚¿ã¯å…¨ã¦ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™</p>
  </div>
</div>

<script>
let records = [];
let isEditing = false;
let editingDate = null;

// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼èª¤æ“ä½œé˜²æ­¢ç”¨
let sliderDragging = { physical: false, mental: false };
let touchStart = { physical: null, mental: null };

function init() {
  const saved = localStorage.getItem('balanceRecords');
  if (saved) records = JSON.parse(saved);
  
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('dateInput').value = today;
  document.getElementById('dateInput').max = today;
  
  setupSlider('physical');
  setupSlider('mental');
  
  updateDisplay();
}

function setupSlider(type) {
  const slider = document.getElementById(`${type}Slider`);
  const valueSpan = document.getElementById(`${type}Value`);
  
  // å€¤ã®å¤‰æ›´
  slider.oninput = function() {
    if (sliderDragging[type]) {
      valueSpan.textContent = this.value;
      updateSliderBackground(this, type);
    }
  };
  
  // ãƒã‚¦ã‚¹æ“ä½œ
  slider.onmousedown = function() {
    sliderDragging[type] = true;
  };
  
  slider.onmouseup = function() {
    sliderDragging[type] = false;
  };
  
  // ã‚¿ãƒƒãƒæ“ä½œï¼ˆèª¤æ“ä½œé˜²æ­¢ï¼‰
  slider.ontouchstart = function(e) {
    const touch = e.touches[0];
    touchStart[type] = { x: touch.clientX, y: touch.clientY };
    sliderDragging[type] = false;
  };
  
  slider.ontouchmove = function(e) {
    if (touchStart[type]) {
      const touch = e.touches[0];
      const moveX = Math.abs(touch.clientX - touchStart[type].x);
      const moveY = Math.abs(touch.clientY - touchStart[type].y);
      
      // æ¨ªç§»å‹•ãŒ5pxä»¥ä¸Š ã‹ã¤ ç¸¦ç§»å‹•ã‚ˆã‚Šå¤§ãã„å ´åˆã®ã¿ãƒ‰ãƒ©ãƒƒã‚°åˆ¤å®š
      if (moveX > 5 && moveX > moveY) {
        sliderDragging[type] = true;
      }
    }
  };
  
  slider.ontouchend = function() {
    sliderDragging[type] = false;
    touchStart[type] = null;
  };
  
  updateSliderBackground(slider, type);
}

function updateSliderBackground(slider, type) {
  const value = slider.value;
  const percent = (value - 1) / 9 * 100;
  const color = type === 'physical' ? '#86efac' : '#fca5a5';
  slider.style.background = `linear-gradient(90deg, ${color} ${percent}%, #d1d5db ${percent}%)`;
}

function saveRecord() {
  const date = document.getElementById('dateInput').value;
  const physical = parseInt(document.getElementById('physicalSlider').value);
  const mental = parseInt(document.getElementById('mentalSlider').value);
  const memo = document.getElementById('memoInput').value.trim();
  
  if (isEditing && editingDate !== date) {
    records = records.filter(r => r.date !== editingDate && r.date !== date);
  } else {
    records = records.filter(r => r.date !== date);
  }
  
  records.push({ date, physical, mental, memo });
  records.sort((a, b) => new Date(a.date) - new Date(b.date));
  
  localStorage.setItem('balanceRecords', JSON.stringify(records));
  showNotification(isEditing ? 'è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼' : 'è¨˜éŒ²ã—ã¾ã—ãŸï¼');
  
  isEditing = false;
  editingDate = null;
  resetForm();
  updateDisplay();
}

function editRecord(date) {
  const record = records.find(r => r.date === date);
  if (!record) return;
  
  isEditing = true;
  editingDate = date;
  
  document.getElementById('dateInput').value = record.date;
  document.getElementById('physicalSlider').value = record.physical;
  document.getElementById('mentalSlider').value = record.mental;
  document.getElementById('memoInput').value = record.memo;
  
  document.getElementById('physicalValue').textContent = record.physical;
  document.getElementById('mentalValue').textContent = record.mental;
  
  updateSliderBackground(document.getElementById('physicalSlider'), 'physical');
  updateSliderBackground(document.getElementById('mentalSlider'), 'mental');
  
  document.getElementById('inputCard').classList.add('editing');
  document.getElementById('dateLabel').textContent = 'ğŸ“… å¤‰æ›´å¾Œã®æ—¥ä»˜';
  document.getElementById('saveBtn').textContent = 'âœ“ æ›´æ–°ã™ã‚‹';
  document.getElementById('saveBtn').className = 'btn';
  document.getElementById('saveBtn').style.background = 'linear-gradient(135deg, #f59e0b 0%, #f97316 100%)';
  document.getElementById('cancelBtn').style.display = 'block';
  
  window.scrollTo({ top: 0, behavior: 'smooth' });
  showNotification(`${date}ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ä¸­`, 'info');
}

function cancelEdit() {
  isEditing = false;
  editingDate = null;
  resetForm();
  showNotification('ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'info');
}

function resetForm() {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('dateInput').value = today;
  document.getElementById('physicalSlider').value = 5;
  document.getElementById('mentalSlider').value = 5;
  document.getElementById('memoInput').value = '';
  document.getElementById('physicalValue').textContent = '5';
  document.getElementById('mentalValue').textContent = '5';
  
  updateSliderBackground(document.getElementById('physicalSlider'), 'physical');
  updateSliderBackground(document.getElementById('mentalSlider'), 'mental');
  
  document.getElementById('inputCard').classList.remove('editing');
  document.getElementById('dateLabel').textContent = 'ğŸ“… è¨˜éŒ²ã™ã‚‹æ—¥ä»˜';
  document.getElementById('saveBtn').textContent = 'âœ“ è¨˜éŒ²ã™ã‚‹';
  document.getElementById('saveBtn').className = 'btn btn-primary';
  document.getElementById('saveBtn').style.background = '';
  document.getElementById('cancelBtn').style.display = 'none';
}

function updateDisplay() {
  if (records.length === 0) {
    document.getElementById('chartCard').classList.add('hidden');
    document.getElementById('recordsCard').classList.add('hidden');
    document.getElementById('exportCard').classList.add('hidden');
    return;
  }
  
  document.getElementById('chartCard').classList.remove('hidden');
  document.getElementById('recordsCard').classList.remove('hidden');
  document.getElementById('exportCard').classList.remove('hidden');
  
  drawChart();
  displayRecords();
}

function drawChart() {
  const canvas = document.getElementById('chartCanvas');
  const ctx = canvas.getContext('2d');
  
  const dpr = window.devicePixelRatio || 1;
  canvas.width = canvas.offsetWidth * dpr;
  canvas.height = 400 * dpr;
  ctx.scale(dpr, dpr);
  
  const sorted = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));
  const last7 = sorted.slice(0, 7).reverse();
  
  if (last7.length === 0) return;
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  const padding = 50;
  const chartWidth = canvas.offsetWidth - padding * 2;
  const chartHeight = 400 - padding * 2;
  const barSpacing = chartWidth / (last7.length * 2.5 + 1);
  const barWidth = barSpacing * 0.9;
  
  // ã‚°ãƒªãƒƒãƒ‰ç·š
  ctx.strokeStyle = '#e5e7eb';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 10; i += 2) {
    const y = padding + chartHeight - (i / 10 * chartHeight);
    ctx.beginPath();
    ctx.moveTo(padding, y);
    ctx.lineTo(canvas.offsetWidth - padding, y);
    ctx.stroke();
  }
  
  // Yè»¸ãƒ©ãƒ™ãƒ«
  ctx.fillStyle = '#6b7280';
  ctx.font = 'bold 14px sans-serif';
  ctx.textAlign = 'right';
  for (let i = 0; i <= 10; i += 2) {
    const y = padding + chartHeight - (i / 10 * chartHeight);
    ctx.fillText(i, padding - 15, y + 5);
  }
  
  // æ£’ã‚°ãƒ©ãƒ•
  last7.forEach((record, index) => {
    const x = padding + (index * 2.5 + 0.5) * barSpacing;
    
    // ä½“ï¼ˆç·‘ï¼‰
    const physicalHeight = (record.physical / 10) * chartHeight;
    ctx.fillStyle = '#86efac';
    ctx.fillRect(x, padding + chartHeight - physicalHeight, barWidth, physicalHeight);
    
    // å¿ƒï¼ˆèµ¤ï¼‰
    const mentalHeight = (record.mental / 10) * chartHeight;
    ctx.fillStyle = '#fca5a5';
    ctx.fillRect(x + barWidth + 5, padding + chartHeight - mentalHeight, barWidth, mentalHeight);
    
    // æ•°å€¤ãƒ©ãƒ™ãƒ«
    ctx.fillStyle = '#374151';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(record.physical, x + barWidth / 2, padding + chartHeight - physicalHeight - 5);
    ctx.fillText(record.mental, x + barWidth + 5 + barWidth / 2, padding + chartHeight - mentalHeight - 5);
    
    // æ—¥ä»˜ãƒ©ãƒ™ãƒ«
    const date = new Date(record.date);
    const label = `${date.getMonth() + 1}/${date.getDate()}`;
    ctx.fillStyle = '#374151';
    ctx.font = 'bold 13px sans-serif';
    ctx.fillText(label, x + barWidth + 2.5, canvas.offsetHeight / dpr - padding + 25);
  });
  
  // å‡¡ä¾‹
  ctx.fillStyle = '#86efac';
  ctx.fillRect(padding, 15, 25, 25);
  ctx.fillStyle = '#374151';
  ctx.font = 'bold 16px sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText('ä½“', padding + 35, 33);
  
  ctx.fillStyle = '#fca5a5';
  ctx.fillRect(padding + 100, 15, 25, 25);
  ctx.fillStyle = '#374151';
  ctx.fillText('å¿ƒ', padding + 135, 33);
}

function displayRecords() {
  const sorted = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));
  let html = '';
  sorted.forEach(r => {
    html += `<div class="record">
      <div class="record-header">
        <div>
          <strong style="font-size:16px;">${r.date}</strong>
          <span class="badge badge-green">ä½“ ${r.physical}</span>
          <span class="badge badge-red">å¿ƒ ${r.mental}</span>
        </div>
        <button class="btn btn-edit" onclick="editRecord('${r.date}')">âœï¸ ç·¨é›†</button>
      </div>
      ${r.memo ? `<p style="margin-top:12px; color:#374151; line-height:1.6;">${r.memo}</p>` : ''}
    </div>`;
  });
  document.getElementById('recordsList').innerHTML = html;
}

function showNotification(msg, type = 'success') {
  const notif = document.getElementById('notification');
  notif.textContent = msg;
  notif.className = 'notification';
  if (type === 'error') notif.classList.add('error');
  if (type === 'info') notif.classList.add('info');
  setTimeout(() => notif.classList.add('hidden'), 3000);
}

function copyForAI() {
  if (records.length === 0) {
    showNotification('è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
    return;
  }
  
  let text = 'ç§ã¯è‡ªåˆ†ã®çŠ¶æ…‹ã‚’èª¬æ˜ã™ã‚‹ã®ãŒè‹¦æ‰‹ã§ã™ã€‚ä»¥ä¸‹ã®è¨˜éŒ²ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚\n\n';
  text += 'â–¼ã“ã“ã‹ã‚‰ã‚³ãƒ”ãƒ¼â–¼\n\n';
  records.forEach(r => {
    text += `æ—¥ä»˜: ${r.date}\nä½“: ${r.physical}/10\nå¿ƒ: ${r.mental}/10\nãƒ¡ãƒ¢: ${r.memo || 'ãªã—'}\n\n`;
  });
  text += 'â–²ã“ã“ã¾ã§ã‚³ãƒ”ãƒ¼â–²';
  
  navigator.clipboard.writeText(text).then(() => {
    showNotification(`âœ“ ${records.length}æ—¥åˆ†ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼`);
  }).catch(() => {
    alert(text);
  });
}

function generateEmail() {
  if (records.length === 0) {
    showNotification('è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
    return;
  }
  
  let data = '';
  records.forEach(r => {
    data += `æ—¥ä»˜: ${r.date}\nä½“: ${r.physical}/10\nå¿ƒ: ${r.mental}/10\nãƒ¡ãƒ¢: ${r.memo || 'ãªã—'}\n\n`;
  });
  
  const email = `ä»¶å: ç§ã®ä½“èª¿ãƒ¬ãƒãƒ¼ãƒˆ

æœ¬æ–‡:

æ”¯æ´å“¡æ§˜

ãŠç–²ã‚Œæ§˜ã§ã™ã€‚ä½“èª¿è¨˜éŒ²ã‚’é€ä»˜ã—ã¾ã™ã€‚

ã€æœŸé–“ã€‘å…¨${records.length}æ—¥åˆ†

ã€ãƒ‡ãƒ¼ã‚¿ã€‘
${data}

ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚`;
  
  navigator.clipboard.writeText(email).then(() => {
    showNotification('âœ“ ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
  }).catch(() => {
    alert(email);
  });
}

window.addEventListener('resize', () => {
  if (records.length > 0) drawChart();
});

init();
</script>

</body>
</html>